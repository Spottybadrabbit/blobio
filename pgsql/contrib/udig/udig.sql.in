/*
 *  Synopsis:
 *	Create PostgreSQL UDIG Data Types, including SHA1.
 *  Usage:
 *	make udig.sql
 *	psql <<END
 *	DROP TYPE udig CASCADE;
 *	DROP TYPE udig_sha CASCADE;
 *	DROP TYPE udig_bitrip CASCADE;
 *	DROP OPERATOR FAMILY udig_clan USING btree CASCADE;
 *	END
 *	psql -f udig.sql
 *  Note:
 *	Should a udig be in the blobio schema?
 */
\set ON_ERROR_STOP

SET search_path = public;

/*
 *  SHA1 UDig Core Type.
 */
CREATE TYPE udig_sha;					-- sha1 udig type

CREATE OR REPLACE FUNCTION udig_sha_in(cstring)		-- cstring to internal
RETURNS udig_sha
AS 'MODULE_PATHNAME', 'udig_sha_in'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_out(udig_sha)	-- internal to cstring
RETURNS cstring
AS 'MODULE_PATHNAME', 'udig_sha_out'
IMMUTABLE STRICT LANGUAGE C;

CREATE TYPE udig_sha
(
	input =			udig_sha_in,
	output =		udig_sha_out,
	internallength =	20
);

/*
 *  Generic UDIG Core Type.
 */
CREATE TYPE udig;					-- temporay shell type

CREATE OR REPLACE FUNCTION udig_in(cstring)		-- cstring to internal
RETURNS udig
AS 'MODULE_PATHNAME', 'udig_in'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_can_cast(cstring)	-- cstring is valid udig
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_can_cast'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_out(udig)		-- internal to cstring
RETURNS cstring
AS 'MODULE_PATHNAME', 'udig_out'
IMMUTABLE STRICT LANGUAGE C;

CREATE TYPE udig
(
	input =			udig_in,
	output =		udig_out,
	internallength =	variable
);

/*
 *  Functions for core SHA data types.
 */
CREATE OR REPLACE FUNCTION udig_sha_eq(udig_sha, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_eq'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_ne(udig_sha, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_ne'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_lt(udig_sha, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_lt'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_le(udig_sha, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_le'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_gt(udig_sha, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_gt'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_ge(udig_sha, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_ge'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_cmp(udig_sha, udig_sha)
RETURNS integer
AS 'MODULE_PATHNAME', 'udig_sha_cmp'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  Functions for cross compare SHA-generic UDIG data types.
 */
CREATE OR REPLACE FUNCTION udig_sha_eq_udig(udig_sha, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_eq_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_ne_udig(udig_sha, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_ne_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_lt_udig(udig_sha, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_lt_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_le_udig(udig_sha, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_le_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_gt_udig(udig_sha, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_gt_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_ge_udig(udig_sha, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_sha_ge_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_sha_cmp_udig(udig_sha, udig)
RETURNS integer
AS 'MODULE_PATHNAME', 'udig_sha_cmp_udig'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  Cast SHA to generic udig.
 */
CREATE OR REPLACE FUNCTION udig_sha_cast(udig_sha)
RETURNS udig
AS 'MODULE_PATHNAME', 'udig_sha_cast'
IMMUTABLE STRICT LANGUAGE C;

CREATE CAST (udig_sha AS udig)
  WITH FUNCTION udig_sha_cast(udig_sha)
  AS IMPLICIT
;

/*
 *  Core SHA Comparison Operators
 */
CREATE OPERATOR =
(
	leftarg =		udig_sha,
	rightarg =		udig_sha,
	procedure =		udig_sha_eq,
	commutator =		=,
	negator =		<>,
	restrict =		eqsel,
	join =			eqjoinsel
);

CREATE OPERATOR <>
(
	leftarg =		udig_sha,
	rightarg =		udig_sha,
	procedure =		udig_sha_ne,
	commutator =		<>,
	negator =		=,
	restrict =		neqsel,
	join =			neqjoinsel
);

CREATE OPERATOR >
(
	leftarg =		udig_sha,
	rightarg =		udig_sha,
	procedure =		udig_sha_gt,
	commutator =		<,
	negator =		<=,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR >=
(
	leftarg =		udig_sha,
	rightarg =		udig_sha,
	procedure =		udig_sha_ge,
	commutator =		<=,
	negator =		<,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR <
(
	leftarg =		udig_sha,
	rightarg =		udig_sha,
	procedure =		udig_sha_lt,
	commutator =		>,
	negator =		>=,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR <=
(
	leftarg =		udig_sha,
	rightarg =		udig_sha,
	procedure =		udig_sha_le,
	commutator =		>=,
	negator =		>,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

/*
 *  Cross Type SHA to UDig Comparison Operators
 */
CREATE OPERATOR =					-- = (sha, udig)
(
	leftarg =		udig_sha,
	rightarg =		udig,
	procedure =		udig_sha_eq_udig,
	commutator =		=,
	negator =		<>,
	restrict =		eqsel,
	join =			eqjoinsel
);

CREATE OPERATOR <>					-- <> (sha, udig)
(
	leftarg =		udig_sha,
	rightarg =		udig,
	procedure =		udig_sha_ne_udig,
	commutator =		<>,
	negator =		=,
	restrict =		neqsel,
	join =			neqjoinsel
);

CREATE OPERATOR >					-- > (sha, udig)
(
	leftarg =		udig_sha,
	rightarg =		udig,
	procedure =		udig_sha_gt_udig,
	commutator =		<,
	negator =		<=,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR >=					-- >= (sha, udig)
(
	leftarg =		udig_sha,
	rightarg =		udig,
	procedure =		udig_sha_ge_udig,
	commutator =		<=,
	negator =		<,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR <					-- < (sha, udig)
(
	leftarg =		udig_sha,
	rightarg =		udig,
	procedure =		udig_sha_lt_udig,
	commutator =		>,
	negator =		>=,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR <=					-- <= (sha, udig)
(
	leftarg =		udig_sha,
	rightarg =		udig,
	procedure =		udig_sha_le_udig,
	commutator =		>=,
	negator =		>,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

/*
 *  Create Core UDIG Functions
 */

CREATE OR REPLACE FUNCTION udig_eq(udig, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_eq'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_ne(udig, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_ne'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_lt(udig, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_lt'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_le(udig, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_le'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_gt(udig, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_gt'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_ge(udig, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_ge'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_cmp(udig, udig)
RETURNS integer
AS 'MODULE_PATHNAME', 'udig_cmp'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  Create Cross UDIG,SHA Functions
 */
CREATE OR REPLACE FUNCTION udig_eq_sha(udig, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_eq_sha'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_ne_sha(udig, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_ne_sha'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_lt_sha(udig, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_lt_sha'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_le_sha(udig, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_le_sha'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_gt_sha(udig, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_gt_sha'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_ge_sha(udig, udig_sha)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_ge_sha'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_cmp_sha(udig, udig_sha)
RETURNS integer
AS 'MODULE_PATHNAME', 'udig_cmp_sha'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  Core UDIG Operators.
 */
CREATE OPERATOR =
(
	leftarg =		udig,
	rightarg =		udig,
	procedure =		udig_eq,
	commutator =		=,
	negator =		<>,
	restrict =		eqsel,
	join =			eqjoinsel
);

CREATE OPERATOR <>
(
	leftarg =		udig,
	rightarg =		udig,
	procedure =		udig_ne,
	commutator =		<>,
	negator =		=,
	restrict =		neqsel,
	join =			neqjoinsel
);

CREATE OPERATOR >
(
	leftarg =		udig,
	rightarg =		udig,
	procedure =		udig_gt,
	commutator =		<,
	negator =		<=,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR >=
(
	leftarg =		udig,
	rightarg =		udig,
	procedure =		udig_ge,
	commutator =		<=,
	negator =		<,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR <
(
	leftarg =		udig,
	rightarg =		udig,
	procedure =		udig_lt,
	commutator =		>,
	negator =		>=,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR <=
(
	leftarg =		udig,
	rightarg =		udig,
	procedure =		udig_le,
	commutator =		>=,
	negator =		>,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

/*
 *  Cross Type UDIG,SHA Operators.
 */
CREATE OPERATOR =
(
	leftarg =		udig,
	rightarg =		udig_sha,
	procedure =		udig_eq_sha,
	commutator =		=,
	negator =		<>,
	restrict =		eqsel,
	join =			eqjoinsel
);

CREATE OPERATOR <>
(
	leftarg =		udig,
	rightarg =		udig_sha,
	procedure =		udig_ne_sha,
	commutator =		<>,
	negator =		=,
	restrict =		neqsel,
	join =			neqjoinsel
);

CREATE OPERATOR >
(
	leftarg =		udig,
	rightarg =		udig_sha,
	procedure =		udig_gt_sha,
	commutator =		<,
	negator =		<=,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR >=
(
	leftarg =		udig,
	rightarg =		udig_sha,
	procedure =		udig_ge_sha,
	commutator =		<=,
	negator =		<,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR <
(
	leftarg =		udig,
	rightarg =		udig_sha,
	procedure =		udig_lt_sha,
	commutator =		>,
	negator =		>=,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR <=
(
	leftarg =		udig,
	rightarg =		udig_sha,
	procedure =		udig_le_sha,
	commutator =		>=,
	negator =		>,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

/*
 *  Define operator family 'udig_clan' according to
 *
 *	http://www.postgresql.org/docs/9.0/static/xindex.html
 */
CREATE OPERATOR FAMILY udig_clan USING btree;

/*
 *  Core Operator Classes for generic udig, udig_sha.
 */
CREATE OPERATOR CLASS udig_ops
  DEFAULT FOR TYPE udig USING btree FAMILY udig_clan AS
        OPERATOR        1       <	(udig, udig),
        OPERATOR        2       <=	(udig, udig),
        OPERATOR        3       =	(udig, udig),
        OPERATOR        4       >=	(udig, udig),
        OPERATOR        5       >	(udig, udig),
        FUNCTION        1       udig_cmp(udig, udig)
;
CREATE OPERATOR CLASS udig_sha_ops
  DEFAULT FOR TYPE udig_sha USING btree FAMILY udig_clan AS
        OPERATOR        1       <	(udig_sha, udig_sha),
        OPERATOR        2       <=	(udig_sha, udig_sha),
        OPERATOR        3       =	(udig_sha, udig_sha),
        OPERATOR        4       >=	(udig_sha, udig_sha),
        OPERATOR        5       >	(udig_sha, udig_sha),
        FUNCTION        1       udig_sha_cmp
					(udig_sha, udig_sha)
;

/*
 *  Add cross type - sha/generic udig - operator classes to udig_clan family.
 */
ALTER OPERATOR FAMILY udig_clan USING btree ADD

  --  cross type for sha and udig
  OPERATOR 1 	<	(udig_sha, udig),
  OPERATOR 2	<=	(udig_sha, udig),
  OPERATOR 3	=	(udig_sha, udig),
  OPERATOR 4	>=	(udig_sha, udig),
  OPERATOR 5	>	(udig_sha, udig),
  FUNCTION 1	udig_sha_cmp_udig	(udig_sha, udig),

  --  cross type for udig and sha
  OPERATOR 1 	<	(udig, udig_sha),
  OPERATOR 2	<=	(udig, udig_sha),
  OPERATOR 3	=	(udig, udig_sha),
  OPERATOR 4	>=	(udig, udig_sha),
  OPERATOR 5	>	(udig, udig_sha),
  FUNCTION 1	udig_cmp_sha	(udig, udig_sha)
;

CREATE OR REPLACE FUNCTION udig_algorithm(udig)
RETURNS cstring
AS 'MODULE_PATHNAME', 'udig_algorithm'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  RIPEMD160(RIPEMD160(SHA256)) UDig Core Type.
 */
CREATE TYPE udig_bitrip;					-- bitrip udig type

CREATE OR REPLACE FUNCTION udig_bitrip_in(cstring)	-- cstring to internal
RETURNS udig_bitrip
AS 'MODULE_PATHNAME', 'udig_bitrip_in'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_out(udig_bitrip)	-- internal to cstring
RETURNS cstring
AS 'MODULE_PATHNAME', 'udig_bitrip_out'
IMMUTABLE STRICT LANGUAGE C;

CREATE TYPE udig_bitrip
(
	input =			udig_bitrip_in,
	output =		udig_bitrip_out,
	internallength =	20
);

/*
 *  Functions for core RIPEMD160(RIPEMD160(SHA256)) data types.
 */
CREATE OR REPLACE FUNCTION udig_bitrip_eq(udig_bitrip, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_eq'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_ne(udig_bitrip, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_ne'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_lt(udig_bitrip, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_lt'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_le(udig_bitrip, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_le'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_gt(udig_bitrip, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_gt'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_ge(udig_bitrip, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_ge'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_cmp(udig_bitrip, udig_bitrip)
RETURNS integer
AS 'MODULE_PATHNAME', 'udig_bitrip_cmp'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  Functions for cross compare RIPEMD160(RIPEMD160(SHA256))-generic
 *  UDIG data types.
 */
CREATE OR REPLACE FUNCTION udig_bitrip_eq_udig(udig_bitrip, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_eq_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_ne_udig(udig_bitrip, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_ne_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_lt_udig(udig_bitrip, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_lt_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_le_udig(udig_bitrip, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_le_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_gt_udig(udig_bitrip, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_gt_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_ge_udig(udig_bitrip, udig)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_bitrip_ge_udig'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_bitrip_cmp_udig(udig_bitrip, udig)
RETURNS integer
AS 'MODULE_PATHNAME', 'udig_bitrip_cmp_udig'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  Cast RIPEMD160(SHA256) to generic udig.
 */
CREATE OR REPLACE FUNCTION udig_bitrip_cast(udig_bitrip)
RETURNS udig
AS 'MODULE_PATHNAME', 'udig_bitrip_cast'
IMMUTABLE STRICT LANGUAGE C;

CREATE CAST (udig_bitrip AS udig)
  WITH FUNCTION udig_bitrip_cast(udig_bitrip)
  AS IMPLICIT
;

/*
 *  Core RIPEMD160(SHA256) Comparison Operators
 */
CREATE OPERATOR =
(
	leftarg =		udig_bitrip,
	rightarg =		udig_bitrip,
	procedure =		udig_bitrip_eq,
	commutator =		=,
	negator =		<>,
	restrict =		eqsel,
	join =			eqjoinsel
);

CREATE OPERATOR <>
(
	leftarg =		udig_bitrip,
	rightarg =		udig_bitrip,
	procedure =		udig_bitrip_ne,
	commutator =		<>,
	negator =		=,
	restrict =		neqsel,
	join =			neqjoinsel
);

CREATE OPERATOR >
(
	leftarg =		udig_bitrip,
	rightarg =		udig_bitrip,
	procedure =		udig_bitrip_gt,
	commutator =		<,
	negator =		<=,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR >=
(
	leftarg =		udig_bitrip,
	rightarg =		udig_bitrip,
	procedure =		udig_bitrip_ge,
	commutator =		<=,
	negator =		<,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR <
(
	leftarg =		udig_bitrip,
	rightarg =		udig_bitrip,
	procedure =		udig_bitrip_lt,
	commutator =		>,
	negator =		>=,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR <=
(
	leftarg =		udig_bitrip,
	rightarg =		udig_bitrip,
	procedure =		udig_bitrip_le,
	commutator =		>=,
	negator =		>,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

/*
 *  Cross Type RIPEMD160(SHA256) to UDig Comparison Operators
 */
CREATE OPERATOR =					-- = (bitrip, udig)
(
	leftarg =		udig_bitrip,
	rightarg =		udig,
	procedure =		udig_bitrip_eq_udig,
	commutator =		=,
	negator =		<>,
	restrict =		eqsel,
	join =			eqjoinsel
);

CREATE OPERATOR <>					-- <> (bitrip, udig)
(
	leftarg =		udig_bitrip,
	rightarg =		udig,
	procedure =		udig_bitrip_ne_udig,
	commutator =		<>,
	negator =		=,
	restrict =		neqsel,
	join =			neqjoinsel
);

CREATE OPERATOR >					-- > (bitrip, udig)
(
	leftarg =		udig_bitrip,
	rightarg =		udig,
	procedure =		udig_bitrip_gt_udig,
	commutator =		<,
	negator =		<=,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR >=					-- >= (bitrip, udig)
(
	leftarg =		udig_bitrip,
	rightarg =		udig,
	procedure =		udig_bitrip_ge_udig,
	commutator =		<=,
	negator =		<,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR <					-- < (bitrip, udig)
(
	leftarg =		udig_bitrip,
	rightarg =		udig,
	procedure =		udig_bitrip_lt_udig,
	commutator =		>,
	negator =		>=,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR <=					-- <= (bitrip, udig)
(
	leftarg =		udig_bitrip,
	rightarg =		udig,
	procedure =		udig_bitrip_le_udig,
	commutator =		>=,
	negator =		>,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

/*
 *  Create Cross UDIG,RIPEMD160(SHA256) Functions
 */
CREATE OR REPLACE FUNCTION udig_eq_bitrip(udig, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_eq_bitrip'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_ne_bitrip(udig, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_ne_bitrip'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_lt_bitrip(udig, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_lt_bitrip'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_le_bitrip(udig, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_le_bitrip'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_gt_bitrip(udig, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_gt_bitrip'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_ge_bitrip(udig, udig_bitrip)
RETURNS boolean
AS 'MODULE_PATHNAME', 'udig_ge_bitrip'
IMMUTABLE STRICT LANGUAGE C;

CREATE OR REPLACE FUNCTION udig_cmp_bitrip(udig, udig_bitrip)
RETURNS integer
AS 'MODULE_PATHNAME', 'udig_cmp_bitrip'
IMMUTABLE STRICT LANGUAGE C;

/*
 *  Cross Type UDIG,RIPEMD160(SHA256) Operators.
 */
CREATE OPERATOR =
(
	leftarg =		udig,
	rightarg =		udig_bitrip,
	procedure =		udig_eq_bitrip,
	commutator =		=,
	negator =		<>,
	restrict =		eqsel,
	join =			eqjoinsel
);

CREATE OPERATOR <>
(
	leftarg =		udig,
	rightarg =		udig_bitrip,
	procedure =		udig_ne_bitrip,
	commutator =		<>,
	negator =		=,
	restrict =		neqsel,
	join =			neqjoinsel
);

CREATE OPERATOR >
(
	leftarg =		udig,
	rightarg =		udig_bitrip,
	procedure =		udig_gt_bitrip,
	commutator =		<,
	negator =		<=,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR >=
(
	leftarg =		udig,
	rightarg =		udig_bitrip,
	procedure =		udig_ge_bitrip,
	commutator =		<=,
	negator =		<,
	restrict =		scalargtsel,
	join =			scalargtjoinsel
);

CREATE OPERATOR <
(
	leftarg =		udig,
	rightarg =		udig_bitrip,
	procedure =		udig_lt_bitrip,
	commutator =		>,
	negator =		>=,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR <=
(
	leftarg =		udig,
	rightarg =		udig_bitrip,
	procedure =		udig_le_bitrip,
	commutator =		>=,
	negator =		>,
	restrict =		scalarltsel,
	join =			scalarltjoinsel
);

CREATE OPERATOR CLASS udig_bitrip_ops
  DEFAULT FOR TYPE udig_bitrip USING btree FAMILY udig_clan AS
        OPERATOR        1       <	(udig_bitrip, udig_bitrip),
        OPERATOR        2       <=	(udig_bitrip, udig_bitrip),
        OPERATOR        3       =	(udig_bitrip, udig_bitrip),
        OPERATOR        4       >=	(udig_bitrip, udig_bitrip),
        OPERATOR        5       >	(udig_bitrip, udig_bitrip),
        FUNCTION        1       udig_bitrip_cmp
					(udig_bitrip, udig_bitrip)
;

/*
 *  Add cross type - bitrip/generic udig - operator classes to udig_clan family.
 */
ALTER OPERATOR FAMILY udig_clan USING btree ADD

  --  cross type for bitrip and udig
  OPERATOR 1 	<	(udig_bitrip, udig),
  OPERATOR 2	<=	(udig_bitrip, udig),
  OPERATOR 3	=	(udig_bitrip, udig),
  OPERATOR 4	>=	(udig_bitrip, udig),
  OPERATOR 5	>	(udig_bitrip, udig),
  FUNCTION 1	udig_bitrip_cmp_udig	(udig_bitrip, udig),

  --  cross type for udig and bitrip
  OPERATOR 1 	<	(udig, udig_bitrip),
  OPERATOR 2	<=	(udig, udig_bitrip),
  OPERATOR 3	=	(udig, udig_bitrip),
  OPERATOR 4	>=	(udig, udig_bitrip),
  OPERATOR 5	>	(udig, udig_bitrip),
  FUNCTION 1	udig_cmp_bitrip	(udig, udig_bitrip)
;
